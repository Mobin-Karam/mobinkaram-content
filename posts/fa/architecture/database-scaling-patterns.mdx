---
title: "الگوهای مقیاس‌پذیری پایگاه داده"
description: "چه زمانی سراغ مقیاس عمودی، replica خواندنی، کش یا شاردینگ برویم"
date: "2026-02-15"
slug: "database-scaling-patterns"
tags: ["database", "scaling", "architecture"]
category: "architecture"
cover: "/assets/images/database-scaling.jpg"
readingTime: 9
published: true
author: "Mobin Karam"
---

قبل از اینکه کاربران تمام شوند، معمولاً دیتابیس تک‌نود شما تمام می‌شود. این راهنما الگوهای رایج مقیاس‌پذیری را به علائمی که حل می‌کنند وصل می‌کند و معامله‌های هر کدام را یادآوری می‌کند.

## فشار خواندن در برابر نوشتن

- **خواندن بالا، نوشتن پایدار:** **کش** (CDN/Redis) و **read replica** اضافه کنید.  
- **نوشتن بالا:** به **پارتیشن‌بندی** (بر اساس tenant، منطقه یا رنج کلید) و طراحی کلید اولیه برای اجتناب از hot spot فکر کنید.

## الگوهای مقیاس

- **مقیاس عمودی:** ساده‌ترین اهرم کوتاه‌مدت؛ IOPS و اشباع حافظه را رصد کنید.  
- **Replica خواندنی:** بار خواندن را کم می‌کند؛ سازگاری نهایی برای اکثر خواندن‌ها پذیرفته است، نه برای شمارنده و موجودی.  
- **کش:** کش لبه یا اپلیکیشن تعداد ضربه به DB را کم می‌کند؛ TTL و قواعد invalidation را از ابتدا مشخص کنید.  
- **شاردینگ:** داده را بین پرایمری‌ها تقسیم می‌کند؛ نیازمند کلید شارد، لایه روتینگ و پلن rebalance است.  
- **آرشیو/ذخیره سرد:** داده تاریخی را به ذخیره ارزان منتقل کنید تا مجموعه داغ کوچک بماند.

## انتخاب کلید شارد

- **تنوع و توزیع:** از شارد داغ پرهیز کنید؛ وقتی مطمئن نیستید hash کنید.  
- **محلی بودن:** داده‌هایی که کنار هم مصرف می‌شوند (tenantId، region) را هم‌محل کنید.  
- **تغییرناپذیری:** کلید شارد نباید عوض شود؛ وگرنه نیاز به جابه‌جایی بین شارد دارید.

## نگهبان‌های عملیاتی

- تراکنش‌های **سراسری** را نادر نگه دارید؛ گردش‌کار را per-shard طراحی کنید.  
- **تراز مجدد خودکار** و هشدار ظرفیت برای هر شارد داشته باشید.  
- **نوشتن idempotent** و مهاجرت‌های قابل replay را enforce کنید.  
- ابزار **backfill** با امکان throttling و resume آماده کنید.

## تکامل اسکیما در مقیاس

- مهاجرت‌های **expand/contract**: ستون جدید، backfill، سویچ خواندن، سپس حذف ستون قدیمی.  
- مهاجرت را **per-shard** و با rate limit اجرا کنید؛ lag replication را مانیتور کنید.  
- **ایندکس آنلاین** بسازید و از قفل جدول در اوج بار پرهیز کنید.

## چک‌لیست بازبینی طراحی

- آمار بار: نسبت read/write، تأخیر P99، اندازه رکورد، رشد ماهانه.  
- الگوی مقیاس انتخابی و دلیل رد گزینه‌های دیگر.  
- حالت‌های خطا: lag replica، cache stampede، split-brain، اثر تراز مجدد.  
- پوشش ران‌بوک: اضافه کردن شارد، rebuild replica و invalidation امن کش.

مقیاس‌پذیری مجموعه‌ای از قدم‌های سنجیده و قابل بازگشت است. ساده شروع کنید، اندازه بگیرید و پیچیدگی را فقط وقتی اضافه کنید که متریک‌ها درخواست می‌کنند.












